<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/abstractTask.js - preceptor</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="preceptor"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AbstractClient.html">AbstractClient</a></li>
            
                <li><a href="../classes/AbstractClientDecorator.html">AbstractClientDecorator</a></li>
            
                <li><a href="../classes/AbstractForkTask.html">AbstractForkTask</a></li>
            
                <li><a href="../classes/AbstractTask.html">AbstractTask</a></li>
            
                <li><a href="../classes/AbstractTaskDecorator.html">AbstractTaskDecorator</a></li>
            
                <li><a href="../classes/Client.html">Client</a></li>
            
                <li><a href="../classes/Config.html">Config</a></li>
            
                <li><a href="../classes/Coverage.html">Coverage</a></li>
            
                <li><a href="../classes/CucumberClient.html">CucumberClient</a></li>
            
                <li><a href="../classes/CucumberTask.html">CucumberTask</a></li>
            
                <li><a href="../classes/DecoratorTaskDecorator.html">DecoratorTaskDecorator</a></li>
            
                <li><a href="../classes/GroupTask.html">GroupTask</a></li>
            
                <li><a href="../classes/GroupTaskDecorator.html">GroupTaskDecorator</a></li>
            
                <li><a href="../classes/IdentifierTaskDecorator.html">IdentifierTaskDecorator</a></li>
            
                <li><a href="../classes/JUnitTask.html">JUnitTask</a></li>
            
                <li><a href="../classes/KoboldClient.html">KoboldClient</a></li>
            
                <li><a href="../classes/KoboldTask.html">KoboldTask</a></li>
            
                <li><a href="../classes/MochaClient.html">MochaClient</a></li>
            
                <li><a href="../classes/MochaTask.html">MochaTask</a></li>
            
                <li><a href="../classes/NodeClient.html">NodeClient</a></li>
            
                <li><a href="../classes/NodeTask.html">NodeTask</a></li>
            
                <li><a href="../classes/PlainClientDecorator.html">PlainClientDecorator</a></li>
            
                <li><a href="../classes/PreceptorManager.html">PreceptorManager</a></li>
            
                <li><a href="../classes/ShellTask.html">ShellTask</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/abstractTask.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
// Copyright 2014, Yahoo! Inc.
// Copyrights licensed under the Mit License. See the accompanying LICENSE file for terms.

var Base = require(&#x27;preceptor-core&#x27;).Base;
var utils = require(&#x27;preceptor-core&#x27;).utils;
var logger = require(&#x27;log4js&#x27;).getLogger(__filename);
var Promise = require(&#x27;promise&#x27;);
var _ = require(&#x27;underscore&#x27;);
var uuid = require(&#x27;uuid&#x27;);

var defaultTask = require(&#x27;./defaults/defaultTask&#x27;);

/**
 * @class AbstractTask
 * @extends Base
 *
 * @property {ReportManager} _reportManager
 * @property {object} _plugins
 * @property {object} _options
 * @property {object} _config
 * @property {Collector} _coverageCollector
 */
var AbstractTask = Base.extend(

	/**
	 * Abstract task constructor
	 *
	 * @param {object} config
	 * @param {Collector} coverageCollector
	 * @param {ReportManager} reportManager
	 * @param {object} plugins
	 * @param {object} plugins.taskDecorator
	 * @param {object} plugins.clientDecorator
	 * @param {object} plugins.task
	 * @param {object} options
	 * @constructor
	 */
	function (config, coverageCollector, reportManager, plugins, options) {
		this.__super();

		this._config = config;
		this._coverageCollector = coverageCollector;
		this._reportManager = reportManager;
		this._plugins = plugins;
		this._options = utils.deepExtend({}, [defaultTask, plugins.sharedOptions || {}, options || {}]);

		this.initialize();
	},

	{
		/**
		 * Initializes the instance
		 *
		 * @method initialize
		 */
		initialize: function () {

			// Make sure the configuration has the correct structure
			this.validate();

			// Augment options with outside data
			this.augment();
		},


		/**
		 * Validates the given data
		 *
		 * @method validate
		 */
		validate: function () {
			if (!_.isObject(this.getOptions())) {
				throw new Error(&#x27;The options parameter is not an object.&#x27;);
			}
			if (!_.isObject(this.getConfiguration())) {
				throw new Error(&#x27;The &quot;configuration&quot; parameter is not an object.&#x27;);
			}
			if (!_.isObject(this.getDecorators())) {
				throw new Error(&#x27;The &quot;decorators&quot; parameter is not an object.&#x27;);
			}
			if (!_.isString(this.getType())) {
				throw new Error(&#x27;The &quot;type&quot; parameter is not a string.&#x27;);
			}
			if (!_.isString(this.getTaskId())) {
				throw new Error(&#x27;The &quot;taskId&quot; parameter is not a string.&#x27;);
			}
			if (!_.isString(this.getName())) {
				throw new Error(&#x27;The &quot;name&quot; parameter is not a string.&#x27;);
			}
			if (!_.isString(this.getTitle())) {
				throw new Error(&#x27;The &quot;title&quot; parameter is not a string.&#x27;);
			}
			if (!_.isBoolean(this.isSuite())) {
				throw new Error(&#x27;The &quot;suite&quot; parameter is not a boolean.&#x27;);
			}
			if (!_.isBoolean(this.isActive())) {
				throw new Error(&#x27;The &quot;active&quot; parameter is not a boolean.&#x27;);
			}
			if (!_.isBoolean(this.isVerbose())) {
				throw new Error(&#x27;The &quot;verbose&quot; parameter is not a boolean.&#x27;);
			}
			if (!_.isBoolean(this.shouldReport())) {
				throw new Error(&#x27;The &quot;report&quot; parameter is not a boolean.&#x27;);
			}
			if (!_.isBoolean(this.shouldEchoStdOut())) {
				throw new Error(&#x27;The &quot;echoStdOut&quot; parameter is not a boolean.&#x27;);
			}
			if (!_.isBoolean(this.shouldEchoStdErr())) {
				throw new Error(&#x27;The &quot;echoStdErr&quot; parameter is not a boolean.&#x27;);
			}
		},

		/**
		 * Augments the data with default values
		 *
		 * @method augment
		 */
		augment: function () {
			// Nothing yet
		},


		/**
		 * Gets the options
		 *
		 * @method getOptions
		 * @return {object}
		 */
		getOptions: function () {
			return this._options;
		},

		/**
		 * Gets the client configuration
		 *
		 * @method getConfiguration
		 * @return {object}
		 */
		getConfiguration: function () {
			return this.getOptions().configuration;
		},

		/**
		 * Gets the decorator list
		 *
		 * @method getDecorators
		 * @return {object[]}
		 */
		getDecorators: function () {
			return this.getOptions().decorators;
		},

		/**
		 * Gets the global configuration
		 *
		 * @method getGlobalConfig
		 * @returns {Object}
		 */
		getGlobalConfig: function () {
			return this._config;
		},

		/**
		 * Gets the coverage collector
		 *
		 * @method getCoverageCollector
		 * @returns {Collector}
		 */
		getCoverageCollector: function () {
			return this._coverageCollector;
		},

		/**
		 * Gets the type of the preceptor task
		 *
		 * @method getType
		 * @return {string}
		 */
		getType: function () {
			return this.getOptions().type;
		},

		/**
		 * Gets a unique id for the task
		 *
		 * @method getTaskId
		 * @return {string}
		 */
		getTaskId: function () {
			return this.getOptions().taskId;
		},

		/**
		 * Gets the name of the preceptor task
		 *
		 * @method getName
		 * @return {string}
		 */
		getName: function () {
			return this.getOptions().name;
		},

		/**
		 * Gets the title of the preceptor task
		 *
		 * @method getTitle
		 * @return {string}
		 */
		getTitle: function () {
			return this.getOptions().title;
		},

		/**
		 * Run tasks in a suite?
		 *
		 * @method isSuite
		 * @return {boolean}
		 */
		isSuite: function () {
			return this.getOptions().suite;
		},

		/**
		 * Is the task in debug-mode?
		 *
		 * @method inDebug
		 * @return {boolean}
		 */
		inDebug: function () {
			return this.getOptions().debug;
		},

		/**
		 * Is the task active?
		 *
		 * @method isActive
		 * @return {boolean}
		 */
		isActive: function () {
			return this.getOptions().active;
		},

		/**
		 * Is the task verbose?
		 *
		 * @method isVerbose
		 * @return {boolean}
		 */
		isVerbose: function () {
			return this.getOptions().verbose;
		},

		/**
		 * Should report?
		 *
		 * @method shouldReport
		 * @return {boolean}
		 */
		shouldReport: function () {
			return this.getOptions().report;
		},

		/**
		 * Echo std-out output of child-process?
		 *
		 * @method shouldEchoStdOut
		 * @return {boolean}
		 */
		shouldEchoStdOut: function () {
			return this.getOptions().echoStdOut;
		},

		/**
		 * Echo std-err output of child-process?
		 *
		 * @method shouldEchoStdErr
		 * @return {boolean}
		 */
		shouldEchoStdErr: function () {
			return this.getOptions().echoStdErr;
		},


		/**
		 * Gets all plugins
		 *
		 * @method getPlugins
		 * @return {object}
		 */
		getPlugins: function () {
			return this._plugins;
		},

		/**
		 * Gets all options-decorator plugins
		 *
		 * @method getTaskDecoratorPlugins
		 * @return {AbstractTaskDecorator[]}
		 */
		getTaskDecoratorPlugins: function () {
			return _.values(this.getPlugins().taskDecorator);
		},

		/**
		 * Gets all client-decorator plugins
		 *
		 * @method getClientDecoratorPlugins
		 * @return {object[]}
		 */
		getClientDecoratorPlugins: function () {
			return this.getPlugins().clientDecorator;
		},

		/**
		 * Gets a specific task plugin
		 *
		 * @method getTaskPlugin
		 * @param {string} name
		 * @return {AbstractTask}
		 */
		getTaskPlugin: function (name) {
			return this.getPlugins().task[name.toLowerCase()];
		},


		/**
		 * Gets the report manager
		 *
		 * @method getReportManager
		 * @return {ReportManager}
		 */
		getReportManager: function () {
			return this._reportManager;
		},


		/**
		 * Gets the label of the task
		 *
		 * @method getLabel
		 * @return {string}
		 */
		getLabel: function () {
			return this.getName() + &#x27;-&#x27; + this.getTaskId();
		},


		/**
		 * Run the task
		 *
		 * @method run
		 * @param {string} parentId
		 * @return {Promise}
		 */
		run: function (parentId) {

			var suiteId = parentId,
				promise;

			if (this.isActive()) {

				// Should task be wrapped in a suite? Start it
				if (this.isSuite()) {
					suiteId = &#x27;group-&#x27; + uuid.v4(); // Generate unique-id
					this.getReportManager().message().suiteStart(suiteId, parentId, this.getTitle());
				}

				// Run task
				promise = this._run(suiteId);

				// Should tasks be wrapped in a suite? Finish it up
				if (this.isSuite()) {
					promise = promise.then(function () {
						this.getReportManager().message().suiteEnd(suiteId);
					}.bind(this), function (err) {
						this.getReportManager().message().suiteEnd(suiteId);
						throw err;
					}.bind(this));
				}

				return promise;

			} else {
				logger.debug(&#x27;Skip task since it is inactive. &#x27; + this.getLabel());
				return Promise.resolve();
			}
		},

		/**
		 * Run the task
		 *
		 * @method _run
		 * @param {string} parentId
		 * @return {Promise}
		 * @private
		 */
		_run: function (parentId) {
			throw new Error(&#x27;Unimplemented task function &quot;run&quot;.&#x27;);
		}
	},

	{
		/**
		 * @property TYPE
		 * @type {string}
		 * @static
		 */
		TYPE: &#x27;AbstractTask&#x27;
	});

module.exports = AbstractTask;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
